var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};var SciServer=function(a,c){this.sciUrls=a;this.isDebug=c};SciServer.prototype.onError=function(a){this.isDebug&&console.log("BG: error "+a)};
SciServer.prototype.saveAndProcessArticles=function(a,c,b){var g=this.isDebug,d=void 0;browser.storage.local.get().then(function(f){var k=f.origin;f=c.tab.id;var h=function(a){var c=!0;$.ajax({type:"POST",url:k+"/ext/"+b.data.map,data:a,async:!1,success:function(a){g&&console.log("BG: normalized data arrives");c=a},error:function(b,d,e){if(413===b.status)for(a=JSON.parse(a),b=(a.length/2>>0)+1,g&&console.log("BG: too many articles ("+a.length+")"),c=[],d=$jscomp.makeIterator([0,1]),e=d.next();!e.done;e=
d.next())if(e=e.value,e=h(JSON.stringify(a.slice(e*b,(e+1)*b))),"boolean"!==typeof e)c.push.apply(c,$jscomp.arrayFromIterable(e));else{c=!0;break}},dataType:"json",contentType:"application/json"});return c};d=h(a);"boolean"!==typeof d?browser.tabs.sendMessage(f,{name:messages.NORMALIZED_DATA,data:d,map:b.data.map}):g&&console.log("BG: normalized data error: ")},this.onError)};
SciServer.prototype.saveResearchMap=function(a,c,b){var g=this.isDebug;browser.storage.local.get().then(function(d){var f=d.origin;b="undefined"!==typeof b?b:d.map;null==b&&(g&&console.log("BG: warn! unsetted research map name."),b="demo");$.ajax({type:"POST",url:f+"/research/"+b+"/save_articles",data:a,success:c,error:function(a,c,b){alert("BG: Data didn't save.")},contentType:"application/json"})},this.onError)};
SciServer.prototype.getTermsFromResearch=function(a){var c=this.isDebug;browser.storage.local.get().then(function(b){$.ajax({type:"GET",url:b.origin+"/research/"+b.map+"/terms/getFromResearch/"+b.topCount,success:function(b){c&&(console.log("BG: terms from research arrives"),console.log(b));browser.tabs.sendMessage(a,{name:messages.EXTRACTED_TERMS_RESEARCH,data:b})},error:function(a,b,f){c&&console.log("BG: terms extraction error: "+b+f)}})},this.onError)};
SciServer.prototype.getTermsFromClusters=function(a){var c=this.isDebug;browser.storage.local.get().then(function(b){$.ajax({type:"GET",url:b.origin+"/research/"+b.map+"/terms/getFromClusters/"+b.topCount,success:function(b){0==b.length?c&&console.log("BG: there are no terms from clusters"):(c&&(console.log("BG: terms from cluster arrives"),console.log(b)),browser.tabs.sendMessage(a,{name:messages.EXTRACTED_TERMS_CLUSTERS,data:b}))},error:function(a,b,f){c&&console.log("BG: terms extraction error: "+
b+f)}})},this.onError)};
